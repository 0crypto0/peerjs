/*! peerjs build:0.3.14, production. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */(function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=typeof require=="function"&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}var f=typeof require=="function"&&require;for(var g=0;g<d.length;g++)e(d[g]);return e})({1:[function(a,b,c){b.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription;b.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;b.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(a,b,c){var d=a("./util");var e=a("eventemitter3");var f=a("./negotiator");var g=a("reliable");function h(a,b,c){if(!(this instanceof h))return new h(a,b,c);e.call(this);this.options=d.extend({serialization:"binary",reliable:false},c);this.open=false;this.type="data";this.peer=a;this.provider=b;this.id=this.options.connectionId||h._idPrefix+d.randomToken();this.label=this.options.label||this.id;this.metadata=this.options.metadata;this.serialization=this.options.serialization;this.reliable=this.options.reliable;this._buffer=[];this._buffering=false;this.bufferSize=0;this._chunkedData={};if(this.options._payload){this._peerBrowser=this.options._payload.browser}f.startConnection(this,this.options._payload||{originator:true})}d.inherits(h,e);h._idPrefix="dc_";h.prototype.initialize=function(a){this._dc=this.dataChannel=a;this._configureDataChannel()};h.prototype._configureDataChannel=function(){var a=this;if(d.supports.sctp){this._dc.binaryType="arraybuffer"}this._dc.onopen=function(){d.log("Data channel connection success");a.open=true;a.emit("open")};if(!d.supports.sctp&&this.reliable){this._reliable=new g(this._dc,d.debug)}if(this._reliable){this._reliable.onmessage=function(b){a.emit("data",b)}}else{this._dc.onmessage=function(b){a._handleDataMessage(b)}}this._dc.onclose=function(b){d.log("DataChannel closed for:",a.peer);a.close()}};h.prototype._handleDataMessage=function(a){var b=this;var c=a.data;var e=c.constructor;if(this.serialization==="binary"||this.serialization==="binary-utf8"){if(e===Blob){d.blobToArrayBuffer(c,function(a){c=d.unpack(a);b.emit("data",c)});return}else if(e===ArrayBuffer){c=d.unpack(c)}else if(e===String){var f=d.binaryStringToArrayBuffer(c);c=d.unpack(f)}}else if(this.serialization==="json"){c=JSON.parse(c)}if(c.__peerData){var g=c.__peerData;var h=this._chunkedData[g]||{data:[],count:0,total:c.total};h.data[c.n]=c.data;h.count+=1;if(h.total===h.count){delete this._chunkedData[g];c=new Blob(h.data);this._handleDataMessage({data:c})}this._chunkedData[g]=h;return}this.emit("data",c)};h.prototype.close=function(){if(!this.open){return}this.open=false;f.cleanup(this);this.emit("close")};h.prototype.send=function(a,b){if(!this.open){this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this._reliable){this._reliable.send(a);return}var c=this;if(this.serialization==="json"){this._bufferedSend(JSON.stringify(a))}else if(this.serialization==="binary"||this.serialization==="binary-utf8"){var e=d.pack(a);var f=d.chunkedBrowsers[this._peerBrowser]||d.chunkedBrowsers[d.browser];if(f&&!b&&e.size>d.chunkedMTU){this._sendChunks(e);return}if(!d.supports.sctp){d.blobToBinaryString(e,function(a){c._bufferedSend(a)})}else if(!d.supports.binaryBlob){d.blobToArrayBuffer(e,function(a){c._bufferedSend(a)})}else{this._bufferedSend(e)}}else{this._bufferedSend(a)}};h.prototype._bufferedSend=function(a){if(this._buffering||!this._trySend(a)){this._buffer.push(a);this.bufferSize=this._buffer.length}};h.prototype._trySend=function(a){try{this._dc.send(a)}catch(b){this._buffering=true;var c=this;setTimeout(function(){c._buffering=false;c._tryBuffer()},100);return false}return true};h.prototype._tryBuffer=function(){if(this._buffer.length===0){return}var a=this._buffer[0];if(this._trySend(a)){this._buffer.shift();this.bufferSize=this._buffer.length;this._tryBuffer()}};h.prototype._sendChunks=function(a){var b=d.chunk(a);for(var c=0,e=b.length;c<e;c+=1){var a=b[c];this.send(a,true)}};h.prototype.handleMessage=function(a){var b=a.payload;switch(a.type){case"ANSWER":this._peerBrowser=b.browser;f.handleSDP(a.type,this,b.sdp);break;case"CANDIDATE":f.handleCandidate(this,b.candidate);break;default:d.warn("Unrecognized message type:",a.type,"from peer:",this.peer);break}};b.exports=h},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(a,b,c){window.Socket=a("./socket");window.MediaConnection=a("./mediaconnection");window.DataConnection=a("./dataconnection");window.Peer=a("./peer");window.RTCPeerConnection=a("./adapter").RTCPeerConnection;window.RTCSessionDescription=a("./adapter").RTCSessionDescription;window.RTCIceCandidate=a("./adapter").RTCIceCandidate;window.Negotiator=a("./negotiator");window.util=a("./util");window.BinaryPack=a("js-binarypack")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(a,b,c){var d=a("./util");var e=a("eventemitter3");var f=a("./negotiator");function g(a,b,c){if(!(this instanceof g))return new g(a,b,c);e.call(this);this.options=d.extend({},c);this.open=false;this.type="media";this.peer=a;this.provider=b;this.metadata=this.options.metadata;this.localStream=this.options._stream;this.id=this.options.connectionId||g._idPrefix+d.randomToken();if(this.localStream){f.startConnection(this,{_stream:this.localStream,originator:true})}}d.inherits(g,e);g._idPrefix="mc_";g.prototype.addStream=function(a){d.log("Receiving stream",a);this.remoteStream=a;this.emit("stream",a)};g.prototype.handleMessage=function(a){var b=a.payload;switch(a.type){case"ANSWER":f.handleSDP(a.type,this,b.sdp);this.open=true;break;case"CANDIDATE":f.handleCandidate(this,b.candidate);break;default:d.warn("Unrecognized message type:",a.type,"from peer:",this.peer);break}};g.prototype.answer=function(a){if(this.localStream){d.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this.options._payload._stream=a;this.localStream=a;f.startConnection(this,this.options._payload);var b=this.provider._getMessages(this.id);for(var c=0,e=b.length;c<e;c+=1){this.handleMessage(b[c])}this.open=true};g.prototype.close=function(){if(!this.open){return}this.open=false;f.cleanup(this);this.emit("close")};b.exports=g},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(a,b,c){var d=a("./util");var e=a("./adapter").RTCPeerConnection;var f=a("./adapter").RTCSessionDescription;var g=a("./adapter").RTCIceCandidate;var h={pcs:{data:{},media:{}},queue:[]};h._idPrefix="pc_";h.startConnection=function(a,b){var c=h._getPeerConnection(a,b);if(a.type==="media"&&b._stream){c.addStream(b._stream)}a.pc=a.peerConnection=c;if(b.originator){if(a.type==="data"){var e={};if(!d.supports.sctp){e={reliable:b.reliable}}var f=c.createDataChannel(a.label,e);a.initialize(f)}if(!d.supports.onnegotiationneeded){h._makeOffer(a)}}else{h.handleSDP("OFFER",a,b.sdp)}};h._getPeerConnection=function(a,b){if(!h.pcs[a.type]){d.error(a.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere.")}if(!h.pcs[a.type][a.peer]){h.pcs[a.type][a.peer]={}}var c=h.pcs[a.type][a.peer];var e;if(b.pc){e=h.pcs[a.type][a.peer][b.pc]}if(!e||e.signalingState!=="stable"){e=h._startPeerConnection(a)}return e};h._startPeerConnection=function(a){d.log("Creating RTCPeerConnection.");var b=h._idPrefix+d.randomToken();var c={};if(a.type==="data"&&!d.supports.sctp){c={optional:[{RtpDataChannels:true}]}}else if(a.type==="media"){c={optional:[{DtlsSrtpKeyAgreement:true}]}}var f=new e(a.provider.options.config,c);h.pcs[a.type][a.peer][b]=f;h._setupListeners(a,f,b);return f};h._setupListeners=function(a,b,c){var e=a.peer;var f=a.id;var g=a.provider;d.log("Listening for ICE candidates.");b.onicecandidate=function(b){if(b.candidate){d.log("Received ICE candidates for:",a.peer);g.socket.send({type:"CANDIDATE",payload:{candidate:b.candidate,type:a.type,connectionId:a.id},dst:e})}};b.oniceconnectionstatechange=function(){switch(b.iceConnectionState){case"failed":d.log("iceConnectionState is disconnected, closing connections to "+e);a.emit("error",new Error("Negotiation of connection to "+e+" failed."));a.close();break;case"disconnected":d.log("iceConnectionState is disconnected, closing connections to "+e);a.close();break;case"completed":b.onicecandidate=d.noop;break}};b.onicechange=b.oniceconnectionstatechange;d.log("Listening for `negotiationneeded`");b.onnegotiationneeded=function(){d.log("`negotiationneeded` triggered");if(b.signalingState=="stable"){h._makeOffer(a)}else{d.log("onnegotiationneeded triggered when not stable. Is another connection being established?")}};d.log("Listening for data channel");b.ondatachannel=function(a){d.log("Received data channel");var b=a.channel;var c=g.getConnection(e,f);c.initialize(b)};d.log("Listening for remote stream");b.onaddstream=function(a){d.log("Received remote stream");var b=a.stream;var c=g.getConnection(e,f);if(c.type==="media"){c.addStream(b)}}};h.cleanup=function(a){d.log("Cleaning up PeerConnection to "+a.peer);var b=a.pc;if(!!b&&(b.readyState!=="closed"||b.signalingState!=="closed")){b.close();a.pc=null}};h._makeOffer=function(a){var b=a.pc;b.createOffer(function(c){d.log("Created offer.");if(!d.supports.sctp&&a.type==="data"&&a.reliable){c.sdp=Reliable.higherBandwidthSDP(c.sdp)}b.setLocalDescription(c,function(){d.log("Set localDescription: offer","for:",a.peer);a.provider.socket.send({type:"OFFER",payload:{sdp:c,type:a.type,label:a.label,connectionId:a.id,reliable:a.reliable,serialization:a.serialization,metadata:a.metadata,browser:d.browser},dst:a.peer})},function(b){a.provider.emitError("webrtc",b);d.log("Failed to setLocalDescription, ",b)})},function(b){a.provider.emitError("webrtc",b);d.log("Failed to createOffer, ",b)},a.options.constraints)};h._makeAnswer=function(a){var b=a.pc;b.createAnswer(function(c){d.log("Created answer.");if(!d.supports.sctp&&a.type==="data"&&a.reliable){c.sdp=Reliable.higherBandwidthSDP(c.sdp)}b.setLocalDescription(c,function(){d.log("Set localDescription: answer","for:",a.peer);a.provider.socket.send({type:"ANSWER",payload:{sdp:c,type:a.type,connectionId:a.id,browser:d.browser},dst:a.peer})},function(b){a.provider.emitError("webrtc",b);d.log("Failed to setLocalDescription, ",b)})},function(b){a.provider.emitError("webrtc",b);d.log("Failed to create answer, ",b)})};h.handleSDP=function(a,b,c){c=new f(c);var e=b.pc;d.log("Setting remote description",c);e.setRemoteDescription(c,function(){d.log("Set remoteDescription:",a,"for:",b.peer);if(a==="OFFER"){h._makeAnswer(b)}},function(a){b.provider.emitError("webrtc",a);d.log("Failed to setRemoteDescription, ",a)})};h.handleCandidate=function(a,b){var c=b.candidate;var e=b.sdpMLineIndex;a.pc.addIceCandidate(new g({sdpMLineIndex:e,candidate:c}));d.log("Added ICE candidate for:",a.peer)};b.exports=h},{"./adapter":1,"./util":8}],6:[function(a,b,c){var d=a("./util");var e=a("eventemitter3");var f=a("./socket");var g=a("./mediaconnection");var h=a("./dataconnection");function i(a,b){if(!(this instanceof i))return new i(a,b);e.call(this);if(a&&a.constructor==Object){b=a;a=undefined}else if(a){a=a.toString()}b=d.extend({debug:0,host:d.CLOUD_HOST,port:d.CLOUD_PORT,key:"peerjs",path:"/",token:d.randomToken(),config:d.defaultConfig},b);this.options=b;if(b.host==="/"){b.host=window.location.hostname}if(b.path[0]!=="/"){b.path="/"+b.path}if(b.path[b.path.length-1]!=="/"){b.path+="/"}if(b.secure===undefined&&b.host!==d.CLOUD_HOST){b.secure=d.isSecure()}if(b.logFunction){d.setLogFunction(b.logFunction)}d.setLogLevel(b.debug);if(!d.supports.audioVideo&&!d.supports.data){this._delayedAbort("browser-incompatible","The current browser does not support WebRTC");return}if(!d.validateId(a)){this._delayedAbort("invalid-id",'ID "'+a+'" is invalid');return}if(!d.validateKey(b.key)){this._delayedAbort("invalid-key",'API KEY "'+b.key+'" is invalid');return}if(b.secure&&b.host==="0.peerjs.com"){this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.");return}this.destroyed=false;this.disconnected=false;this.open=false;this.connections={};this._lostMessages={};this._initializeServerConnection();if(a){this._initialize(a)}else{this._retrieveId()}}d.inherits(i,e);i.prototype._initializeServerConnection=function(){var a=this;this.socket=new f(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key);this.socket.on("message",function(b){a._handleMessage(b)});this.socket.on("error",function(b){a._abort("socket-error",b)});this.socket.on("disconnected",function(){if(!a.disconnected){a.emitError("network","Lost connection to server.");a.disconnect()}});this.socket.on("close",function(){if(!a.disconnected){a._abort("socket-closed","Underlying socket is already closed.")}})};i.prototype._retrieveId=function(a){var b=this;var c=new XMLHttpRequest;var e=this.options.secure?"https://":"http://";var f=e+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";var g="?ts="+(new Date).getTime()+""+Math.random();f+=g;c.open("get",f,true);c.onerror=function(a){d.error("Error retrieving ID",a);var c="";if(b.options.path==="/"&&b.options.host!==d.CLOUD_HOST){c=" If you passed in a `path` to your self-hosted PeerServer, "+"you'll also need to pass in that same path when creating a new "+"Peer."}b._abort("server-error","Could not get an ID from the server."+c)};c.onreadystatechange=function(){if(c.readyState!==4){return}if(c.status!==200){c.onerror();return}b._initialize(c.responseText)};c.send(null)};i.prototype._initialize=function(a){this.id=a;this.socket.start(this.id,this.options.token)};i.prototype._handleMessage=function(a){var b=a.type;var c=a.payload;var e=a.src;var f;switch(b){case"OPEN":this.emit("open",this.id);this.open=true;break;case"ERROR":this._abort("server-error",c.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":d.log("Received leave message from",e);this._cleanupPeer(e);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+e);break;case"OFFER":var i=c.connectionId;f=this.getConnection(e,i);if(f){d.warn("Offer received for existing Connection ID:",i)}else{if(c.type==="media"){f=new g(e,this,{connectionId:i,_payload:c,metadata:c.metadata});this._addConnection(e,f);this.emit("call",f)}else if(c.type==="data"){f=new h(e,this,{connectionId:i,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable});this._addConnection(e,f);this.emit("connection",f)}else{d.warn("Received malformed connection type:",c.type);return}var j=this._getMessages(i);for(var k=0,l=j.length;k<l;k+=1){f.handleMessage(j[k])}}break;default:if(!c){d.warn("You received a malformed message from "+e+" of type "+b);return}var m=c.connectionId;f=this.getConnection(e,m);if(f&&f.pc){f.handleMessage(a)}else if(m){this._storeMessage(m,a)}else{d.warn("You received an unrecognized message:",a)}break}};i.prototype._storeMessage=function(a,b){if(!this._lostMessages[a]){this._lostMessages[a]=[]}this._lostMessages[a].push(b)};i.prototype._getMessages=function(a){var b=this._lostMessages[a];if(b){delete this._lostMessages[a];return b}else{return[]}};i.prototype.connect=function(a,b){if(this.disconnected){d.warn("You cannot connect to a new Peer because you called "+".disconnect() on this Peer and ended your connection with the "+"server. You can create a new Peer to reconnect, or call reconnect "+"on this peer if you believe its ID to still be available.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}var c=new h(a,this,b);this._addConnection(a,c);return c};i.prototype.call=function(a,b,c){if(this.disconnected){d.warn("You cannot connect to a new Peer because you called "+".disconnect() on this Peer and ended your connection with the "+"server. You can create a new Peer to reconnect.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}if(!b){d.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}c=c||{};c._stream=b;var e=new g(a,this,c);this._addConnection(a,e);return e};i.prototype._addConnection=function(a,b){if(!this.connections[a]){this.connections[a]=[]}this.connections[a].push(b)};i.prototype.getConnection=function(a,b){var c=this.connections[a];if(!c){return null}for(var d=0,e=c.length;d<e;d++){if(c[d].id===b){return c[d]}}return null};i.prototype._delayedAbort=function(a,b){var c=this;d.setZeroTimeout(function(){c._abort(a,b)})};i.prototype._abort=function(a,b){d.error("Aborting!");if(!this._lastServerId){this.destroy()}else{this.disconnect()}this.emitError(a,b)};i.prototype.emitError=function(a,b){d.error("Error:",b);if(typeof b==="string"){b=new Error(b)}b.type=a;this.emit("error",b)};i.prototype.destroy=function(){if(!this.destroyed){this._cleanup();this.disconnect();this.destroyed=true}};i.prototype._cleanup=function(){if(this.connections){var a=Object.keys(this.connections);for(var b=0,c=a.length;b<c;b++){this._cleanupPeer(a[b])}}this.emit("close")};i.prototype._cleanupPeer=function(a){var b=this.connections[a];for(var c=0,d=b.length;c<d;c+=1){b[c].close()}};i.prototype.disconnect=function(){var a=this;d.setZeroTimeout(function(){if(!a.disconnected){a.disconnected=true;a.open=false;if(a.socket){a.socket.close()}a.emit("disconnected",a.id);a._lastServerId=a.id;a.id=null}})};i.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed){d.log("Attempting reconnection to server with ID "+this._lastServerId);this.disconnected=false;this._initializeServerConnection();this._initialize(this._lastServerId)}else if(this.destroyed){throw new Error("This peer cannot reconnect to the server. It has already been destroyed.")}else if(!this.disconnected&&!this.open){d.error("In a hurry? We're still trying to make the initial connection!")}else{throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!")}};i.prototype.listAllPeers=function(a){a=a||function(){};var b=this;var c=new XMLHttpRequest;var e=this.options.secure?"https://":"http://";var f=e+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";var g="?ts="+(new Date).getTime()+""+Math.random();f+=g;c.open("get",f,true);c.onerror=function(c){b._abort("server-error","Could not get peers from the server.");a([])};c.onreadystatechange=function(){if(c.readyState!==4){return}if(c.status===401){var e="";if(b.options.host!==d.CLOUD_HOST){e="It looks like you're using the cloud server. You can email "+"team@peerjs.com to enable peer listing for your API key."}else{e="You need to enable `allow_discovery` on your self-hosted "+"PeerServer to use this feature."}a([]);throw new Error("It doesn't look like you have permission to list peers IDs. "+e)}else if(c.status!==200){a([])}else{a(JSON.parse(c.responseText))}};c.send(null)};b.exports=i},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(a,b,c){var d=a("./util");var e=a("eventemitter3");function f(a,b,c,d,g){if(!(this instanceof f))return new f(a,b,c,d,g);e.call(this);this.disconnected=false;this._queue=[];var h=a?"https://":"http://";var i=a?"wss://":"ws://";this._httpUrl=h+b+":"+c+d+g;this._wsUrl=i+b+":"+c+d+"peerjs?key="+g}d.inherits(f,e);f.prototype.start=function(a,b){this.id=a;this._httpUrl+="/"+a+"/"+b;this._wsUrl+="&id="+a+"&token="+b;this._startXhrStream();this._startWebSocket()};f.prototype._startWebSocket=function(a){var b=this;if(this._socket){return}this._socket=new WebSocket(this._wsUrl);this._socket.onmessage=function(a){try{var c=JSON.parse(a.data)}catch(e){d.log("Invalid server message",a.data);return}b.emit("message",c)};this._socket.onclose=function(a){d.log("Socket closed.");b.disconnected=true;b.emit("disconnected")};this._socket.onopen=function(){if(b._timeout){clearTimeout(b._timeout);setTimeout(function(){b._http.abort();b._http=null},5e3)}b._sendQueuedMessages();d.log("Socket open")}};f.prototype._startXhrStream=function(a){try{var b=this;this._http=new XMLHttpRequest;this._http._index=1;this._http._streamIndex=a||0;this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,true);this._http.onerror=function(){clearTimeout(b._timeout);b.emit("disconnected")};this._http.onreadystatechange=function(){if(this.readyState==2&&this.old){this.old.abort();delete this.old}else if(this.readyState>2&&this.status===200&&this.responseText){b._handleStream(this)}};this._http.send(null);this._setHTTPTimeout()}catch(c){d.log("XMLHttpRequest not available; defaulting to WebSockets")}};f.prototype._handleStream=function(a){var b=a.responseText.split("\n");if(a._buffer){while(a._buffer.length>0){var c=a._buffer.shift();var e=b[c];try{e=JSON.parse(e)}catch(f){a._buffer.shift(c);break}this.emit("message",e)}}var g=b[a._index];if(g){a._index+=1;if(a._index===b.length){if(!a._buffer){a._buffer=[]}a._buffer.push(a._index-1)}else{try{g=JSON.parse(g)}catch(f){d.log("Invalid server message",g);return}this.emit("message",g)}}};f.prototype._setHTTPTimeout=function(){var a=this;this._timeout=setTimeout(function(){var b=a._http;if(!a._wsOpen()){a._startXhrStream(b._streamIndex+1);a._http.old=b}else{b.abort()}},25e3)};f.prototype._wsOpen=function(){return this._socket&&this._socket.readyState==1};f.prototype._sendQueuedMessages=function(){for(var a=0,b=this._queue.length;a<b;a+=1){this.send(this._queue[a])}};f.prototype.send=function(a){if(this.disconnected){return}if(!this.id){this._queue.push(a);return}if(!a.type){this.emit("error","Invalid message");return}var b=JSON.stringify(a);if(this._wsOpen()){this._socket.send(b)}else{var c=new XMLHttpRequest;var d=this._httpUrl+"/"+a.type.toLowerCase();c.open("post",d,true);c.setRequestHeader("Content-Type","application/json");c.send(b)}};f.prototype.close=function(){if(!this.disconnected&&this._wsOpen()){this._socket.close();this.disconnected=true}};b.exports=f},{"./util":8,eventemitter3:9}],8:[function(a,b,c){var d={iceServers:[{url:"stun:stun.l.google.com:19302"}]};var e=1;var f=a("js-binarypack");var g=a("./adapter").RTCPeerConnection;var h={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(a){var b=parseInt(a,10);if(!isNaN(parseInt(a,10))){h.logLevel=b}else{h.logLevel=a?3:0}h.log=h.warn=h.error=h.noop;if(h.logLevel>0){h.error=h._printWith("ERROR")}if(h.logLevel>1){h.warn=h._printWith("WARNING")}if(h.logLevel>2){h.log=h._print}},setLogFunction:function(a){if(a.constructor!==Function){h.warn("The log function you passed in is not a function. Defaulting to regular logs.")}else{h._print=a}},_printWith:function(a){return function(){var b=Array.prototype.slice.call(arguments);b.unshift(a);h._print.apply(h,b)}},_print:function(){var a=false;var b=Array.prototype.slice.call(arguments);b.unshift("PeerJS: ");for(var c=0,d=b.length;c<d;c++){if(b[c]instanceof Error){b[c]="("+b[c].name+") "+b[c].message;a=true}}a?console.error.apply(console,b):console.log.apply(console,b)},defaultConfig:d,browser:function(){if(window.mozRTCPeerConnection){return"Firefox"}else if(window.webkitRTCPeerConnection){return"Chrome"}else if(window.RTCPeerConnection){return"Supported"}else{return"Unsupported"}}(),supports:function(){if(typeof g==="undefined"){return{}}var a=true;var b=true;var c=false;var e=false;var f=!!window.webkitRTCPeerConnection;var i,j;try{i=new g(d,{optional:[{RtpDataChannels:true}]})}catch(k){a=false;b=false}if(a){try{j=i.createDataChannel("_PEERJSTEST")}catch(k){a=false}}if(a){try{j.binaryType="blob";c=true}catch(k){}var l=new g(d,{});try{var m=l.createDataChannel("_PEERJSRELIABLETEST",{});e=m.reliable}catch(k){}l.close()}if(b){b=!!i.addStream}if(!f&&a){var n=new g(d,{optional:[{RtpDataChannels:true}]});n.onnegotiationneeded=function(){f=true;if(h&&h.supports){h.supports.onnegotiationneeded=true}};n.createDataChannel("_PEERJSNEGOTIATIONTEST");setTimeout(function(){n.close()},1e3)}if(i){i.close()}return{audioVideo:b,data:a,binaryBlob:c,binary:e,reliable:e,sctp:e,onnegotiationneeded:f}}(),validateId:function(a){return!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(a)},validateKey:function(a){return!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(a)},debug:false,inherits:function(a,b){a.super_=b;a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}})},extend:function(a,b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}return a},pack:f.pack,unpack:f.unpack,log:function(){if(h.debug){var a=false;var b=Array.prototype.slice.call(arguments);b.unshift("PeerJS: ");for(var c=0,d=b.length;c<d;c++){if(b[c]instanceof Error){b[c]="("+b[c].name+") "+b[c].message;a=true}}a?console.error.apply(console,b):console.log.apply(console,b)}},setZeroTimeout:function(a){var b=[];var c="zero-timeout-message";function d(d){b.push(d);a.postMessage(c,"*")}function e(d){if(d.source==a&&d.data==c){if(d.stopPropagation){d.stopPropagation()}if(b.length){b.shift()()}}}if(a.addEventListener){a.addEventListener("message",e,true)}else if(a.attachEvent){a.attachEvent("onmessage",e)}return d}(window),chunk:function(a){var b=[];var c=a.size;var d=index=0;var f=Math.ceil(c/h.chunkedMTU);while(d<c){var g=Math.min(c,d+h.chunkedMTU);var i=a.slice(d,g);var j={__peerData:e,n:index,data:i,total:f};b.push(j);d=g;index+=1}e+=1;return b},blobToArrayBuffer:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsArrayBuffer(a)},blobToBinaryString:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsBinaryString(a)},binaryStringToArrayBuffer:function(a){var b=new Uint8Array(a.length);for(var c=0;c<a.length;c++){b[c]=a.charCodeAt(c)&255}return b.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return location.protocol==="https:"}};b.exports=h},{"./adapter":1,"js-binarypack":10}],9:[function(a,b,c){"use strict";function d(a,b,c){this.fn=a;this.context=b;this.once=c||false}function e(){}e.prototype._events=undefined;e.prototype.listeners=function f(a){if(!this._events||!this._events[a])return[];if(this._events[a].fn)return[this._events[a].fn];for(var b=0,c=this._events[a].length,d=new Array(c);b<c;b++){d[b]=this._events[a][b].fn}return d};e.prototype.emit=function g(a,b,c,d,e,f){if(!this._events||!this._events[a])return false;var g=this._events[a],h=arguments.length,i,j;if("function"===typeof g.fn){if(g.once)this.removeListener(a,g.fn,true);switch(h){case 1:return g.fn.call(g.context),true;case 2:return g.fn.call(g.context,b),true;case 3:return g.fn.call(g.context,b,c),true;case 4:return g.fn.call(g.context,b,c,d),true;case 5:return g.fn.call(g.context,b,c,d,e),true;case 6:return g.fn.call(g.context,b,c,d,e,f),true}for(j=1,i=new Array(h-1);j<h;j++){i[j-1]=arguments[j]}g.fn.apply(g.context,i)}else{var k=g.length,l;for(j=0;j<k;j++){if(g[j].once)this.removeListener(a,g[j].fn,true);switch(h){case 1:g[j].fn.call(g[j].context);break;case 2:g[j].fn.call(g[j].context,b);break;case 3:g[j].fn.call(g[j].context,b,c);break;default:if(!i)for(l=1,i=new Array(h-1);l<h;l++){i[l-1]=arguments[l]}g[j].fn.apply(g[j].context,i)}}}return true};e.prototype.on=function h(a,b,c){var e=new d(b,c||this);if(!this._events)this._events={};if(!this._events[a])this._events[a]=e;else{if(!this._events[a].fn)this._events[a].push(e);else this._events[a]=[this._events[a],e]}return this};e.prototype.once=function i(a,b,c){var e=new d(b,c||this,true);if(!this._events)this._events={};if(!this._events[a])this._events[a]=e;else{if(!this._events[a].fn)this._events[a].push(e);else this._events[a]=[this._events[a],e]}return this};e.prototype.removeListener=function j(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b){if(d.fn&&(d.fn!==b||c&&!d.once)){e.push(d)}if(!d.fn)for(var f=0,g=d.length;f<g;f++){if(d[f].fn!==b||c&&!d[f].once){e.push(d[f])}}}if(e.length){this._events[a]=e.length===1?e[0]:e}else{delete this._events[a]}return this};e.prototype.removeAllListeners=function k(a){if(!this._events)return this;if(a)delete this._events[a];else this._events={};return this};e.prototype.off=e.prototype.removeListener;e.prototype.addListener=e.prototype.on;e.prototype.setMaxListeners=function l(){return this};e.EventEmitter=e;e.EventEmitter2=e;e.EventEmitter3=e;b.exports=e},{}],10:[function(a,b,c){var d=a("./bufferbuilder").BufferBuilder;var e=a("./bufferbuilder").binaryFeatures;var f={unpack:function(a){var b=new g(a);return b.unpack()},pack:function(a){var b=new h;b.pack(a);var c=b.getBuffer();return c}};b.exports=f;function g(a){this.index=0;this.dataBuffer=a;this.dataView=new Uint8Array(this.dataBuffer);this.length=this.dataBuffer.byteLength}g.prototype.unpack=function(){var a=this.unpack_uint8();if(a<128){var b=a;return b}else if((a^224)<32){var c=(a^224)-32;return c}var d;if((d=a^160)<=15){return this.unpack_raw(d)}else if((d=a^176)<=15){return this.unpack_string(d)}else if((d=a^144)<=15){return this.unpack_array(d)}else if((d=a^128)<=15){return this.unpack_map(d)}switch(a){case 192:return null;case 193:return undefined;case 194:return false;case 195:return true;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return undefined;case 213:return undefined;case 214:return undefined;case 215:return undefined;case 216:d=this.unpack_uint16();return this.unpack_string(d);case 217:d=this.unpack_uint32();return this.unpack_string(d);case 218:d=this.unpack_uint16();return this.unpack_raw(d);case 219:d=this.unpack_uint32();return this.unpack_raw(d);case 220:d=this.unpack_uint16();return this.unpack_array(d);case 221:d=this.unpack_uint32();return this.unpack_array(d);case 222:d=this.unpack_uint16();return this.unpack_map(d);case 223:d=this.unpack_uint32();return this.unpack_map(d)}};g.prototype.unpack_uint8=function(){var a=this.dataView[this.index]&255;this.index++;return a};g.prototype.unpack_uint16=function(){var a=this.read(2);var b=(a[0]&255)*256+(a[1]&255);this.index+=2;return b};g.prototype.unpack_uint32=function(){var a=this.read(4);var b=((a[0]*256+a[1])*256+a[2])*256+a[3];this.index+=4;return b};g.prototype.unpack_uint64=function(){var a=this.read(8);var b=((((((a[0]*256+a[1])*256+a[2])*256+a[3])*256+a[4])*256+a[5])*256+a[6])*256+a[7];this.index+=8;return b};g.prototype.unpack_int8=function(){var a=this.unpack_uint8();return a<128?a:a-(1<<8)};g.prototype.unpack_int16=function(){var a=this.unpack_uint16();return a<32768?a:a-(1<<16)};g.prototype.unpack_int32=function(){var a=this.unpack_uint32();return a<Math.pow(2,31)?a:a-Math.pow(2,32)};g.prototype.unpack_int64=function(){var a=this.unpack_uint64();return a<Math.pow(2,63)?a:a-Math.pow(2,64)};g.prototype.unpack_raw=function(a){if(this.length<this.index+a){throw new Error("BinaryPackFailure: index is out of range"+" "+this.index+" "+a+" "+this.length)}var b=this.dataBuffer.slice(this.index,this.index+a);this.index+=a;return b};g.prototype.unpack_string=function(a){var b=this.read(a);var c=0,d="",e,f;while(c<a){e=b[c];if(e<128){d+=String.fromCharCode(e);c++}else if((e^192)<32){f=(e^192)<<6|b[c+1]&63;d+=String.fromCharCode(f);c+=2}else{f=(e&15)<<12|(b[c+1]&63)<<6|b[c+2]&63;d+=String.fromCharCode(f);c+=3}}this.index+=a;return d};g.prototype.unpack_array=function(a){
var b=new Array(a);for(var c=0;c<a;c++){b[c]=this.unpack()}return b};g.prototype.unpack_map=function(a){var b={};for(var c=0;c<a;c++){var d=this.unpack();var e=this.unpack();b[d]=e}return b};g.prototype.unpack_float=function(){var a=this.unpack_uint32();var b=a>>31;var c=(a>>23&255)-127;var d=a&8388607|8388608;return(b==0?1:-1)*d*Math.pow(2,c-23)};g.prototype.unpack_double=function(){var a=this.unpack_uint32();var b=this.unpack_uint32();var c=a>>31;var d=(a>>20&2047)-1023;var e=a&1048575|1048576;var f=e*Math.pow(2,d-20)+b*Math.pow(2,d-52);return(c==0?1:-1)*f};g.prototype.read=function(a){var b=this.index;if(b+a<=this.length){return this.dataView.subarray(b,b+a)}else{throw new Error("BinaryPackFailure: read index out of range")}};function h(){this.bufferBuilder=new d}h.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};h.prototype.pack=function(a){var b=typeof a;if(b=="string"){this.pack_string(a)}else if(b=="number"){if(Math.floor(a)===a){this.pack_integer(a)}else{this.pack_double(a)}}else if(b=="boolean"){if(a===true){this.bufferBuilder.append(195)}else if(a===false){this.bufferBuilder.append(194)}}else if(b=="undefined"){this.bufferBuilder.append(192)}else if(b=="object"){if(a===null){this.bufferBuilder.append(192)}else{var c=a.constructor;if(c==Array){this.pack_array(a)}else if(c==Blob||c==File){this.pack_bin(a)}else if(c==ArrayBuffer){if(e.useArrayBufferView){this.pack_bin(new Uint8Array(a))}else{this.pack_bin(a)}}else if("BYTES_PER_ELEMENT"in a){if(e.useArrayBufferView){this.pack_bin(new Uint8Array(a.buffer))}else{this.pack_bin(a.buffer)}}else if(c==Object){this.pack_object(a)}else if(c==Date){this.pack_string(a.toString())}else if(typeof a.toBinaryPack=="function"){this.bufferBuilder.append(a.toBinaryPack())}else{throw new Error('Type "'+c.toString()+'" not yet supported')}}}else{throw new Error('Type "'+b+'" not yet supported')}this.bufferBuilder.flush()};h.prototype.pack_bin=function(a){var b=a.length||a.byteLength||a.size;if(b<=15){this.pack_uint8(160+b)}else if(b<=65535){this.bufferBuilder.append(218);this.pack_uint16(b)}else if(b<=4294967295){this.bufferBuilder.append(219);this.pack_uint32(b)}else{throw new Error("Invalid length")}this.bufferBuilder.append(a)};h.prototype.pack_string=function(a){var b=j(a);if(b<=15){this.pack_uint8(176+b)}else if(b<=65535){this.bufferBuilder.append(216);this.pack_uint16(b)}else if(b<=4294967295){this.bufferBuilder.append(217);this.pack_uint32(b)}else{throw new Error("Invalid length")}this.bufferBuilder.append(a)};h.prototype.pack_array=function(a){var b=a.length;if(b<=15){this.pack_uint8(144+b)}else if(b<=65535){this.bufferBuilder.append(220);this.pack_uint16(b)}else if(b<=4294967295){this.bufferBuilder.append(221);this.pack_uint32(b)}else{throw new Error("Invalid length")}for(var c=0;c<b;c++){this.pack(a[c])}};h.prototype.pack_integer=function(a){if(-32<=a&&a<=127){this.bufferBuilder.append(a&255)}else if(0<=a&&a<=255){this.bufferBuilder.append(204);this.pack_uint8(a)}else if(-128<=a&&a<=127){this.bufferBuilder.append(208);this.pack_int8(a)}else if(0<=a&&a<=65535){this.bufferBuilder.append(205);this.pack_uint16(a)}else if(-32768<=a&&a<=32767){this.bufferBuilder.append(209);this.pack_int16(a)}else if(0<=a&&a<=4294967295){this.bufferBuilder.append(206);this.pack_uint32(a)}else if(-2147483648<=a&&a<=2147483647){this.bufferBuilder.append(210);this.pack_int32(a)}else if(-0x8000000000000000<=a&&a<=0x8000000000000000){this.bufferBuilder.append(211);this.pack_int64(a)}else if(0<=a&&a<=0x10000000000000000){this.bufferBuilder.append(207);this.pack_uint64(a)}else{throw new Error("Invalid integer")}};h.prototype.pack_double=function(a){var b=0;if(a<0){b=1;a=-a}var c=Math.floor(Math.log(a)/Math.LN2);var d=a/Math.pow(2,c)-1;var e=Math.floor(d*Math.pow(2,52));var f=Math.pow(2,32);var g=b<<31|c+1023<<20|e/f&1048575;var h=e%f;this.bufferBuilder.append(203);this.pack_int32(g);this.pack_int32(h)};h.prototype.pack_object=function(a){var b=Object.keys(a);var c=b.length;if(c<=15){this.pack_uint8(128+c)}else if(c<=65535){this.bufferBuilder.append(222);this.pack_uint16(c)}else if(c<=4294967295){this.bufferBuilder.append(223);this.pack_uint32(c)}else{throw new Error("Invalid length")}for(var d in a){if(a.hasOwnProperty(d)){this.pack(d);this.pack(a[d])}}};h.prototype.pack_uint8=function(a){this.bufferBuilder.append(a)};h.prototype.pack_uint16=function(a){this.bufferBuilder.append(a>>8);this.bufferBuilder.append(a&255)};h.prototype.pack_uint32=function(a){var b=a&4294967295;this.bufferBuilder.append((b&4278190080)>>>24);this.bufferBuilder.append((b&16711680)>>>16);this.bufferBuilder.append((b&65280)>>>8);this.bufferBuilder.append(b&255)};h.prototype.pack_uint64=function(a){var b=a/Math.pow(2,32);var c=a%Math.pow(2,32);this.bufferBuilder.append((b&4278190080)>>>24);this.bufferBuilder.append((b&16711680)>>>16);this.bufferBuilder.append((b&65280)>>>8);this.bufferBuilder.append(b&255);this.bufferBuilder.append((c&4278190080)>>>24);this.bufferBuilder.append((c&16711680)>>>16);this.bufferBuilder.append((c&65280)>>>8);this.bufferBuilder.append(c&255)};h.prototype.pack_int8=function(a){this.bufferBuilder.append(a&255)};h.prototype.pack_int16=function(a){this.bufferBuilder.append((a&65280)>>8);this.bufferBuilder.append(a&255)};h.prototype.pack_int32=function(a){this.bufferBuilder.append(a>>>24&255);this.bufferBuilder.append((a&16711680)>>>16);this.bufferBuilder.append((a&65280)>>>8);this.bufferBuilder.append(a&255)};h.prototype.pack_int64=function(a){var b=Math.floor(a/Math.pow(2,32));var c=a%Math.pow(2,32);this.bufferBuilder.append((b&4278190080)>>>24);this.bufferBuilder.append((b&16711680)>>>16);this.bufferBuilder.append((b&65280)>>>8);this.bufferBuilder.append(b&255);this.bufferBuilder.append((c&4278190080)>>>24);this.bufferBuilder.append((c&16711680)>>>16);this.bufferBuilder.append((c&65280)>>>8);this.bufferBuilder.append(c&255)};function i(a){var b=a.charCodeAt(0);if(b<=2047)return"00";if(b<=65535)return"000";if(b<=2097151)return"0000";if(b<=67108863)return"00000";return"000000"}function j(a){if(a.length>600){return new Blob([a]).size}else{return a.replace(/[^\u0000-\u007F]/g,i).length}}},{"./bufferbuilder":11}],11:[function(a,b,c){var d={};d.useBlobBuilder=function(){try{new Blob([]);return false}catch(a){return true}}();d.useArrayBufferView=!d.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch(a){return true}}();b.exports.binaryFeatures=d;var e=b.exports.BlobBuilder;if(typeof window!="undefined"){e=b.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder}function f(){this._pieces=[];this._parts=[]}f.prototype.append=function(a){if(typeof a==="number"){this._pieces.push(a)}else{this.flush();this._parts.push(a)}};f.prototype.flush=function(){if(this._pieces.length>0){var a=new Uint8Array(this._pieces);if(!d.useArrayBufferView){a=a.buffer}this._parts.push(a);this._pieces=[]}};f.prototype.getBuffer=function(){this.flush();if(d.useBlobBuilder){var a=new e;for(var b=0,c=this._parts.length;b<c;b++){a.append(this._parts[b])}return a.getBlob()}else{return new Blob(this._parts)}};b.exports.BufferBuilder=f},{}],12:[function(a,b,c){var d=a("./util");function e(a,b){if(!(this instanceof e))return new e(a);this._dc=a;d.debug=b;this._outgoing={};this._incoming={};this._received={};this._window=1e3;this._mtu=500;this._interval=0;this._count=0;this._queue=[];this._setupDC()}e.prototype.send=function(a){var b=d.pack(a);if(b.size<this._mtu){this._handleSend(["no",b]);return}this._outgoing[this._count]={ack:0,chunks:this._chunk(b)};if(d.debug){this._outgoing[this._count].timer=new Date}this._sendWindowedChunks(this._count);this._count+=1};e.prototype._setupInterval=function(){var a=this;this._timeout=setInterval(function(){var b=a._queue.shift();if(b._multiple){for(var c=0,d=b.length;c<d;c+=1){a._intervalSend(b[c])}}else{a._intervalSend(b)}},this._interval)};e.prototype._intervalSend=function(a){var b=this;a=d.pack(a);d.blobToBinaryString(a,function(a){b._dc.send(a)});if(b._queue.length===0){clearTimeout(b._timeout);b._timeout=null}};e.prototype._processAcks=function(){for(var a in this._outgoing){if(this._outgoing.hasOwnProperty(a)){this._sendWindowedChunks(a)}}};e.prototype._handleSend=function(a){var b=true;for(var c=0,d=this._queue.length;c<d;c+=1){var e=this._queue[c];if(e===a){b=false}else if(e._multiple&&e.indexOf(a)!==-1){b=false}}if(b){this._queue.push(a);if(!this._timeout){this._setupInterval()}}};e.prototype._setupDC=function(){var a=this;this._dc.onmessage=function(b){var c=b.data;var e=c.constructor;if(e===String){var f=d.binaryStringToArrayBuffer(c);c=d.unpack(f);a._handleMessage(c)}}};e.prototype._handleMessage=function(a){var b=a[1];var c=this._incoming[b];var e=this._outgoing[b];var f;switch(a[0]){case"no":var g=b;if(!!g){this.onmessage(d.unpack(g))}break;case"end":f=c;this._received[b]=a[2];if(!f){break}this._ack(b);break;case"ack":f=e;if(!!f){var h=a[2];f.ack=Math.max(h,f.ack);if(f.ack>=f.chunks.length){d.log("Time: ",new Date-f.timer);delete this._outgoing[b]}else{this._processAcks()}}break;case"chunk":f=c;if(!f){var i=this._received[b];if(i===true){break}f={ack:["ack",b,0],chunks:[]};this._incoming[b]=f}var j=a[2];var k=a[3];f.chunks[j]=new Uint8Array(k);if(j===f.ack[2]){this._calculateNextAck(b)}this._ack(b);break;default:this._handleSend(a);break}};e.prototype._chunk=function(a){var b=[];var c=a.size;var e=0;while(e<c){var f=Math.min(c,e+this._mtu);var g=a.slice(e,f);var h={payload:g};b.push(h);e=f}d.log("Created",b.length,"chunks.");return b};e.prototype._ack=function(a){var b=this._incoming[a].ack;if(this._received[a]===b[2]){this._complete(a);this._received[a]=true}this._handleSend(b)};e.prototype._calculateNextAck=function(a){var b=this._incoming[a];var c=b.chunks;for(var d=0,e=c.length;d<e;d+=1){if(c[d]===undefined){b.ack[2]=d;return}}b.ack[2]=c.length};e.prototype._sendWindowedChunks=function(a){d.log("sendWindowedChunks for: ",a);var b=this._outgoing[a];var c=b.chunks;var e=[];var f=Math.min(b.ack+this._window,c.length);for(var g=b.ack;g<f;g+=1){if(!c[g].sent||g===b.ack){c[g].sent=true;e.push(["chunk",a,g,c[g].payload])}}if(b.ack+this._window>=c.length){e.push(["end",a,c.length])}e._multiple=true;this._handleSend(e)};e.prototype._complete=function(a){d.log("Completed called for",a);var b=this;var c=this._incoming[a].chunks;var e=new Blob(c);d.blobToArrayBuffer(e,function(a){b.onmessage(d.unpack(a))});delete this._incoming[a]};e.higherBandwidthSDP=function(a){var b=navigator.appVersion.match(/Chrome\/(.*?) /);if(b){b=parseInt(b[1].split(".").shift());if(b<31){var c=a.split("b=AS:30");var d="b=AS:102400";if(c.length>1){return c[0]+d+c[1]}}}return a};e.prototype.onmessage=function(a){};b.exports.Reliable=e},{"./util":13}],13:[function(a,b,c){var d=a("js-binarypack");var e={debug:false,inherits:function(a,b){a.super_=b;a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}})},extend:function(a,b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}return a},pack:d.pack,unpack:d.unpack,log:function(){if(e.debug){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}a.unshift("Reliable: ");console.log.apply(console,a)}},setZeroTimeout:function(a){var b=[];var c="zero-timeout-message";function d(d){b.push(d);a.postMessage(c,"*")}function e(d){if(d.source==a&&d.data==c){if(d.stopPropagation){d.stopPropagation()}if(b.length){b.shift()()}}}if(a.addEventListener){a.addEventListener("message",e,true)}else if(a.attachEvent){a.attachEvent("onmessage",e)}return d}(this),blobToArrayBuffer:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsArrayBuffer(a)},blobToBinaryString:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsBinaryString(a)},binaryStringToArrayBuffer:function(a){var b=new Uint8Array(a.length);for(var c=0;c<a.length;c++){b[c]=a.charCodeAt(c)&255}return b.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};b.exports=e},{"js-binarypack":10}]},{},[3]);